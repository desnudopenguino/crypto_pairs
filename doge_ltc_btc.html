<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
	</head>
	<body>
		<table>
			<tr>
				<td></td>
				<td>DOGE/BTC</td>
				<td>DOGE/LTC</td>
				<td>LTC/BTC</td>
			</tr>
			<tr>	
				<td>Last</td>
				<td class="doge_btc"></td>
				<td class="doge_ltc"></td>
				<td class="ltc_btc"></td>
			</tr>
			<tr>	
				<td>Buy</td>
				<td class="doge_btc_buy"></td>
				<td class="doge_ltc_buy"></td>
				<td class="ltc_btc_buy"></td>
			</tr>
			<tr>	
				<td>Sell</td>
				<td class="doge_btc_sell"></td>
				<td class="doge_ltc_sell"></td>
				<td class="ltc_btc_sell"></td>
			</tr>
		</table>
		<h1>BTC -> DOGE -> LTC -> BTC</h1>
		<table>
			<tr>
				<td>Start</td>
				<td id="btc_doge_ltc_final"></td>
			</tr>
				<td ><input id="btc_start" type="text" /></td>
				<td id="btc_ltc_doge_final"></td>
			</tr>
			<tr>
				<td id="btc_end"></td>
			</tr>
		</table>

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js">
</script>
<script type="text/javascript">
$(function () {
		$('#btc_start').val(0.1);
		trade_fee = 0.0034;
		doge_btc = 0;
		doge_btc_trade = 0;
		doge_ltc = 0;
		doge_ltc_trade = 0;
		ltc_btc = 0;
		ltc_btc_trade = 0;
		doge_ltc_btc = 0;
    startRefresh();
});

function calcProfitability(start, p1buy, p2sell, p3sell, fee) {
console.log("Start " + start);
console.log("Trade 1 " + p1buy);
console.log("Trade 2 " + p2sell);
console.log("Trade 3 " + p3sell);
	p1 = ((start - (start*fee))/p1buy)*p2sell;
	p2 = p1 - (p1*fee);
	p3 = p2*p3sell;
	p4 = p3 - (p3*fee);
	return p4;
}

function calcAltProfitability(start, p1buy, p2buy, p3sell, fee) {
console.log("Start " + start);
console.log("Trade 1 " + p1buy);
console.log("Trade 2 " + p2buy);
console.log("Trade 3 " + p3sell);
	p1 = ((start - (start*fee))/p1buy)/p2buy;
	p2 = p1 - (p1*fee);
	p3 = p2*p3sell;
	p4 = p3 - (p3*fee);
	return p4;
}

function startRefresh() {
	setTimeout(startRefresh, 10000)
	//DOGE/BTC
	var url = 'http://pubapi.cryptsy.com/api.php?method=singlemarketdata&marketid=132';
	$.getJSON('http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%3D%22' + encodeURIComponent(url) + '%22&format=json', function (data) {
		doge_btc = data['query'].results.json.return.markets.DOGE.lasttradeprice;
		doge_btc_sell = data['query'].results.json.return.markets.DOGE.sellorders[0].price;
		doge_btc_buy = data['query'].results.json.return.markets.DOGE.buyorders[0].price;

		//DOGE/LTC
		var url = 'http://pubapi.cryptsy.com/api.php?method=singlemarketdata&marketid=135';
		$.getJSON('http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%3D%22' + encodeURIComponent(url) + '%22&format=json', function (data) {
			doge_ltc = data['query'].results.json.return.markets.DOGE.lasttradeprice;
			doge_ltc_buy = data['query'].results.json.return.markets.DOGE.buyorders[0].price;
			doge_ltc_sell = data['query'].results.json.return.markets.DOGE.sellorders[0].price;

			//LTC/BTC 
			var url = 'http://pubapi.cryptsy.com/api.php?method=singlemarketdata&marketid=3';
			$.getJSON('http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%3D%22' + encodeURIComponent(url) + '%22&format=json', function (data) {
				ltc_btc = data['query'].results.json.return.markets.LTC.lasttradeprice;
				ltc_btc_buy = data['query'].results.json.return.markets.LTC.buyorders[0].price;
				ltc_btc_sell = data['query'].results.json.return.markets.LTC.sellorders[0].price;

				$('.doge_btc').html(doge_btc);
				$('.doge_btc_trade').html(doge_btc_trade);
				$('.doge_btc_sell').html(doge_btc_sell);
				$('.doge_btc_buy').html(doge_btc_buy);

				$('.doge_ltc').html(doge_ltc); 
				$('.doge_ltc_trade').html(doge_ltc_trade); 
				$('.doge_ltc_buy').html(doge_ltc_buy); 
				$('.doge_ltc_sell').html(doge_ltc_sell); 

				$('.ltc_btc').html(ltc_btc);
				$('.ltc_btc_trade').html(ltc_btc_trade);
				$('.ltc_btc_buy').html(ltc_btc_buy);
				$('.ltc_btc_sell').html(ltc_btc_sell);

				btc_start = $('#btc_start').val();

				btc_left = btc_start - (btc_start * trade_fee);
//calculate amount of doge to purchase
				buy_doge_btc = (btc_start - (btc_start * trade_fee)) / doge_btc_sell;
//calculate ltc value of doge
				sell_doge_ltc = ((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy;
//subtract fees 2
				ltc_fees = (((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) * trade_fee;
//caltulate what's left
				ltc_left = (((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) - ((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) * trade_fee);
//calculate btc value
				sell_ltc_btc = ((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) - ((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) * trade_fee)) * ltc_btc_sell;
//subtract fees 3
				btc_end_fee = sell_ltc_btc * trade_fee;
//calculate final value!
				btc_end = (((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) - ((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) * trade_fee)) * ltc_btc_sell) -  ((((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) - ((((btc_start - (btc_start * trade_fee)) / doge_btc_sell) * doge_ltc_buy) * trade_fee)) * ltc_btc_sell)*btc_end_fee);
				btc_end = btc_end.toFixed(8);
				$('#btc_end').html(btc_end);

				btc_doge_ltc_end = calcProfitability(btc_start, doge_btc_sell, doge_ltc_buy, ltc_btc_buy, 0.0034);
				btc_doge_ltc_end = btc_doge_ltc_end.toFixed(8);

				$('#btc_doge_ltc_final').html(btc_doge_ltc_end);
				btc_ltc_doge_end = calcAltProfitability(btc_start, ltc_btc_sell, doge_ltc_sell, doge_btc_buy, 0.0034);
				btc_ltc_doge_end = btc_ltc_doge_end.toFixed(8);
				
				$('#btc_ltc_doge_final').html(btc_ltc_doge_end);
			});
		});
	});
}
</script>
	</body>
</html>
